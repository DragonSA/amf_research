% ----------------------------------------------------------------
% AMS-LaTeX definitions for a Dissertation/Thesis ****************
% Template prepared by T.A. McWalter (March 2009)
% ----------------------------------------------------------------
\documentclass[a4paper,11pt,oneside]{report}

% PACKAGES -------------------------------------------------------

\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{fancyhdr}
\usepackage{ifpdf}
\usepackage{mathrsfs}
\usepackage[numbers]{natbib}
\usepackage{xspace}

% GRAPHICS HANDLING ----------------------------------------------

\ifpdf
    \usepackage[pdftex]{graphicx}
    \DeclareGraphicsExtensions{.pdf, .jpg, .tif}
    \newcommand{\bb}{viewport}
\else
    \usepackage{graphicx}
    \DeclareGraphicsExtensions{.eps, .jpg}
    \newcommand{\bb}{bb}
\fi

% OTHER SET-UP ---------------------------------------------------

\pagestyle{fancy}
\lhead{\rightmark}
\chead{}
\rhead{\thepage}
\cfoot{}

\setlength{\topmargin}{0.5cm}
\setlength{\headsep}{1cm}
\setlength{\textwidth}{14.0cm}
\setlength{\headwidth}{14.0cm}
\setlength{\headheight}{14pt}
\setlength{\textheight}{22cm}
\setlength{\oddsidemargin}{1.3cm}
\setlength{\evensidemargin}{0cm}

\newcommand{\setlinespacing}[1]
           {\renewcommand{\baselinestretch}{#1}\small\normalsize}

% THEOREM STYLES -------------------------------------------------

\theoremstyle{plain}
\newtheorem{thm}{Theorem}[chapter]
\newtheorem{prop}[thm]{Proposition}
\newtheorem{cor}[thm]{Corollary}
\newtheorem{con}[thm]{Conjecture}
\newtheorem{lem}[thm]{Lemma}
\theoremstyle{definition}
\newtheorem{defn}[thm]{Definition}
\newtheorem{ass}[thm]{Assumption}
\newtheorem{exam}[thm]{Example}

% MACRO DEFINITIONS ----------------------------------------------

\def\n{\nonumber\\}

% Statistical
\def\E[#1]{\mathbb{E}\left[#1\right]}
\def\Et[#1]{\mathbb{E}_t\left[#1\right]}
\def\Var[#1]{\mathbb{V}\mathtt{ar}\left[#1\right]}

% Derivatives
\def\S{\ensuremath{S_t}\xspace}
\def\dS{\ensuremath{dS_t}\xspace}
\def\dt{\ensuremath{dt}\xspace}
\def\dW{\ensuremath{dW_t}\xspace}
\def\dq{\ensuremath{dq_t}\xspace}

% Differences
\def\DS{\ensuremath{\delta S_t}\xspace}
\def\Dt{\ensuremath{\delta t}\xspace}
\def\DW{\ensuremath{\delta W_t}\xspace}
\def\Dq{\ensuremath{\delta q_t}\xspace}

% Binomial model
\def\u{\ensuremath{u}\xspace}
\def\d{\ensuremath{d}\xspace}
\def\o{\ensuremath{o}\xspace}

\def\pu{\ensuremath{p_\u}\xspace}
\def\pd{\ensuremath{p_\d}\xspace}
\def\po{\ensuremath{p_\o}\xspace}

% Binomial model valuation
\def\V{\ensuremath{V_t}\xspace}
\def\Vu{\ensuremath{V^{u}_t}\xspace}
\def\Vd{\ensuremath{V^{d}_t}\xspace}
\def\X{\ensuremath{X_t}\xspace}
\def\P{\ensuremath{\Pi_t}\xspace}
\def\D{\ensuremath{\Delta_t}\xspace}

% PREAMBLE -------------------------------------------------------

\title{Valuation of Convertible Bonds with Credit Risk}

\author{David Naylor\\[2cm]
Programme in Advanced Mathematics of Finance,\\
University of the Witwatersrand,\\
Johannesburg.\\[2cm]
\includegraphics[width=4cm]{../common/WitsColourLogo}\\[2cm]
}

% MAIN DOCUMENT --------------------------------------------------

\begin{document}

\maketitle \setlinespacing{1.20}

% DECLARATION ----------------------------------------------------

\def\abstractname{\Huge Declaration}
\begin{abstract}
I declare that this project is my own, unaided work. It is being submitted as partial fulfilment of the Degree of Bachelor of Science with Honours in the University of the Witwatersrand, Johannesburg. It has not been submitted before for any degree or examination in any other University.\\[3cm]
\noindent\rule{5cm}{0.5pt}\\[1cm]
\noindent \today
\end{abstract}

% ABSTRACT -------------------------------------------------------

\def\abstractname{\Huge Abstract}
\begin{abstract}
A convertible bond is a complex derivative that cannot be priced as a simple combination of bond and stock components.  Convertible bonds can be broken down as a bond with two embedded options (a put option for the investor and a call option for the issuer) and an option to convert the bond into stock.  Due to the multiple continuous options, the pricing of the convertible bond is path dependent.

This research project explores and implements a binary tree and finite difference scheme to price the convertible bond, taking into account credit risk.
\end{abstract}

% ACKNOWLEDGEMENTS -----------------------------------------------

\def\abstractname{\Huge Acknowledgements}
\begin{abstract}
Place acknowledgements here.
\end{abstract}

% TABLE OF CONTENTS ----------------------------------------------

\setlinespacing{1}
\pagenumbering{roman}
\tableofcontents
\listoffigures
\listoftables
\clearpage
\setlinespacing{1.20}
\pagenumbering{arabic}
\setcounter{page}{1}

% CONTENT --------------------------------------------------------

\chapter{Introduction}
What this paper shows and does.

\section{Convertible Bonds with Credit Risk}
Describe and define (in maths) what a convertible bond with credit risk is.

\section{Literature Review}
Describe the current state of literature w/ Convertible Bonds with Credit Risk,
possibly split this and include it at the beginning of each relevant section?

\section{Example}
Describe the standard example that will be covered by each valuation method.

\chapter{Binomial Model with Credit Risk}
The Binomial Model with Credit Risk was first derived by \citet{MK12}, who showed that this model converges, in continuous time, to the \citet{AFV03} model.  \Citet{MK12} also showed the valuation method of this model is the same as in the classical binomial model.

TODO: add further explanation and references.

\section{Definition}
Consider a stock with the following stochastic model\footnote{Of note $\mathbb{E}[\frac{\dS}{\S}] = r\dt \Leftrightarrow \frac{\dS}{\S} = (r + \lambda\eta)\dt + \sigma\dW - \eta\dq$}:
\begin{equation}
 \frac{\dS}{\S} = (r + \lambda\eta)\dt + \sigma\dW - \eta\dq
\end{equation}
where:

\begin{tabular}{ll}
 $r$            & is the risk free rate \\
 $\sigma$       & is the log-volatility of the stock price \\
 $\lambda$      & is the hazard rate \\
 $\eta$         & is the percentage drop in stock price on a default event \\
 \dW            & is a Wiener process \\
 \dq            & is a Poisson jump process where the first jump is the default event \\
\end{tabular}

\noindent and
\begin{align}
 \E[\frac{\dS}{\S}]     &= r\dt \\
 \E[\frac{S_{t + \dt}}{\S}] &= \E[\frac{\S}{\S} + \frac{\dS}{\S}] \n
                        &= 1 + \E[\frac{\dS}{\S}] \label{eq:SM_E} \\
 \Var[\frac{\dS}{\S}]   &= (\sigma^2 + \lambda\eta^2)\dt \\
 \Var[\frac{S_{t + \dt}}{\S}] &= \Var[\frac{\S}{\S} + \frac{\dS}{\S}] \n
                        &= \Var[\frac{\dS}{\S}] \label{eq:SM_Var}
\end{align}
and consider a binomial model that has time step \Dt, up and down steps, \u and \d with probability \pu and \pd\footnote{$\pd = 1 - \pu - \po = e^{-\lambda\Dt} - \pu$} respectively, and where the probability of default is \po\footnote{The time till the first jump follows an exponential distribution and has probability $1 - e^{-\lambda\Dt}$} and (TODO: insert picture illustration)
\begin{align}
 \E[\frac{S_{t + \Dt}}{\S}]     &= \u\pu + \d\pd + (1 - \eta)\po \n
                                &= \u\pu + \d(e^{-\lambda\Dt} - \pu) + (1 - \eta)(1 - e^{-\lambda\Dt}) \label{eq:BM_E} \\
 \Var[\frac{S_{t + \Dt}}{\S}]   &= \u^2\pu + \d^2\pd + (1 - \eta)^2\po - \E[\frac{\DS}{\S}]^2 \n
                                &= \u^2\pu + \d^2(e^{-\lambda\Dt} - \pu) + (1 - \eta)^2(1 - e^{-\lambda\Dt}) - \E[\frac{S_{t+\Dt}}{\S}]^2 \label{eq:BM_Var}
\end{align}

\section{Derivation}
If one equates the first moment of the stochastic model \eqref{eq:SM_E}\footnote{$\E[\frac{S_{t + \Dt}}{\S}] = e^{r\Dt}$}, in \Dt time, with that of the binomial model \eqref{eq:BM_E} then:
\begin{align}
 e^{r\Dt}       &= \u\pu + \d(e^{-\lambda\Dt} - \pu) + (1 - \eta)(1 - e^{-\lambda\Dt}) \n
 \pu(\u - \d)   &= e^{r\Dt} - \d e^{-\lambda\Dt} - (1 - \eta)(1 - e^{-\lambda\Dt}) \label{eq:p(u-d)}\\
 \pu            &= \frac{e^{r\Dt} - \d e^{-\lambda\Dt} - (1 - \eta)(1 - e^{-\lambda\Dt})}{\u - \d} \\
 \Rightarrow\pd &= -\frac{e^{r\Dt} - \u e^{-\lambda\Dt} - (1 - \eta)(1 - e^{-\lambda\Dt})}{\u - \d}
\end{align}
and if one equate the second moment about the mean of the stochastic model \eqref{eq:SM_Var}, in \Dt time, with that of the binomial model \eqref{eq:BM_Var} then\footnote{Substituting equation \eqref{eq:p(u-d)} into \eqref{eq:Var=1} one gets \eqref{eq:Var=2}}:
\begin{align}
 (\sigma^2 + \lambda\eta^2)\Dt &= \u^2\pu + \d^2(e^{-\lambda\Dt} - \pu) + (1 - \eta)^2(1 - e^{-\lambda\Dt}) - \E[\frac{S_{t + \Dt}}{\S}]^2 \n
                        &= (\u^2 - \d^2)\pu + \d^2 e^{-\lambda\Dt} +  (1 - \eta)^2(1 - e^{-\lambda\Dt}) - e^{-2r\Dt} \label{eq:Var=1} \\
                        &= (\u + \d)(e^{r\Dt} - \d e^{-\lambda\Dt} - (1 - \eta)(1 - e^{-\lambda\Dt})) \label{eq:Var=2} \\
                        &\qquad + \d^2 e^{-\lambda\Dt} + (1 - \eta)^2(1 - e^{-\lambda\Dt}) - e^{-2r\Dt} \n
                        &= (\u + \d)(e^{r\Dt} - (1 - \eta)(1 - e^{-\lambda\Dt})) - \u\d e^{-\lambda\Dt} \label{eq:Var=} \\
                        &\qquad + (1 - \eta)^2(1 - e^{-\lambda\Dt}) - e^{-2r\Dt} \nonumber
\end{align}
If one assumes $\Dt^2 = 0$, $\u\d = 1$ and $\u = e^{\sqrt{A\Dt}}$ and the Taylor series expansion is taken for all exponential terms, then:
\begin{align}
 \u                     &= 1 + \sqrt{A\Dt} + \frac{A\Dt}{2!} + \frac{(A\Dt)^{\frac{3}{2}}}{3!} \n
 \d                     &= 1 - \sqrt{A\Dt} + \frac{A\Dt}{2!} - \frac{(A\Dt)^{\frac{3}{2}}}{3!} \n
 \u + \d                &= 2 + A\Dt \label{eq:u+d}
\end{align}
and substituting \eqref{eq:u+d} into \eqref{eq:Var=} with the appropriate expansions then:
\begin{align}
 (\sigma^2 + \lambda\eta^2)\Dt &= (2 + A\Dt)(1 + r\Dt - \lambda\Dt(1 - \eta)) - (1 - \lambda\Dt) \n
                        &\qquad + \lambda\Dt(1 - \eta)^2 - (1 - 2r\Dt) \n
                        &= A\Dt + \lambda\Dt - \lambda\Dt(1 - \eta)(1 + \eta) \n
                        &= A\Dt + \lambda\eta^2\Dt \n
 A\Dt                   &= \sigma^2\Dt
\end{align}

\section{Valuation}
Consider a portfolio with value \V at time $t$, \D invested in the stock \S and $\P = \V - \D\S$ invested at the risk neutral rate.  At time $t + \Dt$ one should have:
\begin{equation*}
 \Pi_{t + \Dt} =
 \begin{cases}
  \Vu - \D\S u          & \text{with probability } \pu \\
  \Vd - \D\S d          & \text{with probability } \pd\\
  \X - (1 - \eta)\S     & \text{with probability } \po\\
 \end{cases}
\end{equation*}
where

\begin{tabular}{ll}
 $\Vu$          & is the value of the portfolio on an up-step at time $t + \Dt$ \\
 $\Vd$          & is the value of the portfolio on a down-step at time $t + \Dt$ \\
 $\X$           & is the value of default at time $t$ \\
\end{tabular}

If one wishes to hedge against up and down movements of the stock then:
\begin{align}
    \Vu - \D\S u &= \Vd - \D\S d \n
       \D(d - u) &= \Vd - \Vu \n
              \D &= \frac{\Vu - \Vd}{u - d}
\end{align}

The required value of \P at time $t + \Dt$ is:
\begin{align}
 \Pi_{t + \Dt}  &= \P e^{r\Dt} \n
                &= \left(\V - \frac{\Vu - \Vd}{u - d}\right) e^{r\Dt} \label{eq:P}
\end{align}
as \P is invested at the risk free rate, and taking the expected value of $\Pi_{t + \Dt}$, which must equal \eqref{eq:P}, one gets:
\begin{align}
 (\V - \frac{\Vu - \Vd}{u - d}) e^{r\Dt} &= \E[\Pi_{t + \Dt}] \n
        &= \left(\Vu - \frac{\Vu - \Vd}{u - d}u\right) e^{-\lambda\Dt} \n
        &\qquad + \left(\X - \frac{\Vu - \Vd}{u - d}(1 - \eta)\right)(1 - e^{-\lambda\Dt}) \n
        &= \Vu\left(e^{-\lambda\Dt} - \frac{ue^{-\lambda\Dt} + (1 - \eta)(1 - e^{-\lambda\Dt})}{u - d}\right) \n
        &\qquad + \Vd\left(\frac{ue^{-\lambda\Dt} + (1 - \eta)(1 - e^{-\lambda\Dt})}{u - d}\right) + \X(1 - e^{-\lambda\Dt}) \n
 \V e^{r\Dt} &= \Vu\frac{e^{r\Dt} - de^{-\lambda\Dt} - (1 - \eta)(1 - e^{-\lambda\Dt})}{u - d} \n
        &\qquad + \Vd\frac{ue^{-\lambda\Dt} + (1 - \eta)(1 - e^{-\lambda\Dt}) - e^{r\Dt}}{u - d} + \X(1 - e^{-\lambda\Dt}) \n
 \V     &= e^{-r\Dt}(\Vu\pu + \Vd\pd + \X\po)
\end{align}
thus the pricing method of this binomial model is the same as the pricing method of the classical binomial model:
\begin{align}
 V_t    &= e^{-r\Dt}(\Vu\pu + \Vd\pd + \X\po) \n
        &= e^{-r\Dt}\Et[V_{t + \Dt}]
\end{align}

\section{Valuation with Coupon Cash-flow}
Consider a portfolio with value \V at time $t$, as above, with an additional coupon cash flow.  At time $t + \Dt$ one should have:
\begin{equation*}
 \Pi_{t + \Dt} =
 \begin{cases}
  \Vu - \D\S u + c_i e^{t + \Dt - t^{c}_i}      & \text{with probability } \pu \\
  \Vd - \D\S d + c_i e^{t + \Dt - t^{c}_i}      & \text{with probability } \pd\\
  \X - (1 - \eta)\S     & \text{with probability } \po\\
 \end{cases}
\end{equation*}
where

\begin{tabular}{ll}
 $c_i$          & is the i\textsuperscript{th} coupon value \\
 $t^{c}_i$      & is the time of the i\textsuperscript{th} coupon, with $t^{c}_i \in (t, t + \Dt)$ \\
\end{tabular}

Using the above method it is trivial to show that:
\begin{align}
 V_t    &= e^{-r\Dt}(\Vu\pu + \Vd\pd + \X\po) + c_i e^{-r(t^{c}_i - t) - \lambda \Dt} \n
        &= e^{-r\Dt}(\Vu\pu + \Vd\pd + \X\po) + c_i e^{-r(t^{c}_i - t)}(\pu + \pd) \n
        &= e^{-r\Dt}\E[V_{t + \Dt}]
\end{align}
if, however, $t^{c}_i = t$, thus $c_i$ arrives with certainty at $t$, it is trivially shown that:
\begin{align}
 V_t    &= e^{-r\Dt}(\Vu\pu + \Vd\pd + \X\po) + c_i \n
        &= e^{-r\Dt}\Et[V_{t + \Dt}] + c_i
\end{align}



\section{Parameters and Formul\ae\ of Model}
Based on the above Table \ref{tab:bin_parameter} lists the parameters required for, and Table \ref{tab:bin_formulae} lists the formul\ae\ to price, this binomial table.

\begin{table}[ht]
\centering
\caption{Parameters of the Binomial Model with Credit Risk}
\begin{tabular}{|r|l|}\hline
 \textbf{Parameter} & \textbf{Description} \\\hline
 $r$            & Risk free rate \\\hline
 $\sigma$       & Log-volatility of the stock price \\\hline
 $\lambda$      & Hazard rate of default \\\hline
 $\eta$         & Percentage drop of stock price in a default event \\\hline
 \Dt            & Time-step \\\hline
 \Vu            & Value of portfolio for an up-step at $t + \Dt$ \\\hline
 \Vd            & Value of portfolio for a down-step at $t + \Dt$ \\\hline
 \X             & Value of defaulted portfolio at $t$ \\\hline
 $c_i$          & Value of the i\textsuperscript{th} coupon payment \\\hline
 $t^{c}_i$      & Time of the i\textsuperscript{th} coupon payment \\\hline
\end{tabular}
\label{tab:bin_parameter}
\end{table}

\begin{table}[ht]
\centering
\caption{Formal\ae\ for the Binomial Model with Credit Risk}
\begin{tabular}{|rcl|l|l|}\hline
 \multicolumn{3}{|l|}{\textbf{Formul\ae}} & \textbf{Description} \\\hline
 \u     &=& $e^{\sigma\sqrt{\Dt}}$ &
    Multiplier for an up-step \\\hline
 \d     &=& $e^{-\sigma\sqrt{\Dt}}$ &
    Multiplier for a down-step \\\hline
 \pu    &=& $\frac{e^{r\Dt} - \d e^{-\lambda\Dt} - (1 - \eta)(1 - e^{-\lambda\Dt})}{\u - \d}$ &
    Probability of an up-step \\\hline
 \pd    &=& $e^{-\lambda\Dt} - \pu$ &
    Probability of a down-step \\\hline
 \po    &=& $1 - e^{-\lambda\Dt}$ &
    Probability of default \\\hline
 \V     &=& $e^{-r\Dt}(\Vu\pu + \Vd\pd + \X\po) + c_i$ &
    Value of portfolio at $t$ for $t^{c}_i = t$ \\\hline
\end{tabular}
\label{tab:bin_formulae}
\end{table}

\section{Example and Hedging Strategy}
Provide a numerical example (with diagrams) and provide example of the hedging strategy.

\chapter{Finite Difference Model}
Describe the finite difference model based on the paper by \citet{AFV03}.

\chapter{Numerical Example}
Implement above models, explain implementation and results, by example.

\chapter{Conclusion}
Summarise what this paper shows and does (i.e. Introduction + Conclusion = Executive Summary).

% BIBLIOGRAPHY ---------------------------------------------------

\clearpage
\setlinespacing{1}
\addcontentsline{toc}{chapter}{Bibliography}
\bibliographystyle{../references/amsplnat}
\bibliography{../references/references.bib}
\end{document}

%
% Document ends here - everything beyond this point is ignored.
%


% GRAPHIC TEMPLATE FOR EPS OR PDF FILE ---------------------------

\begin{figure}[h!]
    \centering
    \includegraphics[width=8cm]{filename}
    \caption[Short caption for figure list]{Main caption.}\label{FigLabel}
\end{figure}

% GRAPHIC TEMPLATE FOR JPG FILE ----------------------------------

\begin{figure}[h!]
    \centering
    \includegraphics[\bb=0 0 XXX YYY, width=8cm]{filename.jpg}
    \caption[Short caption for figure list]{Main caption.}\label{FigLabel}
\end{figure}

% Replace XXX and YYY with pixel width and height of image.

