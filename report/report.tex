% ----------------------------------------------------------------
% AMS-LaTeX definitions for a Dissertation/Thesis ****************
% Template prepared by T.A. McWalter (March 2009)
% ----------------------------------------------------------------
\documentclass[a4paper,11pt,oneside]{report}

% PACKAGES -------------------------------------------------------

\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{fancyhdr}
\usepackage{footnote}
\usepackage{ifpdf}
\usepackage{mathrsfs}
\usepackage{multirow}
\usepackage[numbers]{natbib}
\usepackage{xspace}

% GRAPHICS HANDLING ----------------------------------------------

\ifpdf
    \usepackage[pdftex]{graphicx}
    \DeclareGraphicsExtensions{.pdf, .jpg, .tif}
    \newcommand{\bb}{viewport}
\else
    \usepackage{graphicx}
    \DeclareGraphicsExtensions{.eps, .jpg}
    \newcommand{\bb}{bb}
\fi

% OTHER SET-UP ---------------------------------------------------

\pagestyle{fancy}
\lhead{\rightmark}
\chead{}
\rhead{\thepage}
\cfoot{}

\setlength{\topmargin}{0.5cm}
\setlength{\headsep}{1cm}
\setlength{\textwidth}{14.0cm}
\setlength{\headwidth}{14.0cm}
\setlength{\headheight}{14pt}
\setlength{\textheight}{22cm}
\setlength{\oddsidemargin}{1.3cm}
\setlength{\evensidemargin}{0cm}

\newcommand{\setlinespacing}[1]
           {\renewcommand{\baselinestretch}{#1}\small\normalsize}

% THEOREM STYLES -------------------------------------------------

\theoremstyle{plain}
\newtheorem{thm}{Theorem}[chapter]
\newtheorem{prop}[thm]{Proposition}
\newtheorem{cor}[thm]{Corollary}
\newtheorem{con}[thm]{Conjecture}
\newtheorem{lem}[thm]{Lemma}
\theoremstyle{definition}
\newtheorem{defn}[thm]{Definition}
\newtheorem{ass}[thm]{Assumption}
\newtheorem{exam}[thm]{Example}

% MACRO DEFINITIONS ----------------------------------------------

\def\n{\nonumber\\}
\def\h{\\\hline}
\newcommand{\theader}[1]{\multicolumn{1}{|c|}{\textbf{#1}}}

% Bond descriptions
\def\t{\ensuremath{t}\xspace}
\def\ti{\ensuremath{t_i}\xspace}
\def\T{\ensuremath{T}\xspace}
\def\N{\ensuremath{N}\xspace}
\def\R{\ensuremath{R}\xspace}
\def\C{\ensuremath{C_i}\xspace}
\def\Kp{\ensuremath{K^{p}_t}\xspace}
\def\Kc{\ensuremath{K^{c}_t}\xspace}
\def\Kv{\ensuremath{\kappa_t}\xspace}
\def\Tp{\ensuremath{\Omega^{p}}\xspace}
\def\Tc{\ensuremath{\Omega^{c}}\xspace}
\def\Tv{\ensuremath{\Omega^{v}}\xspace}
\def\ST{\ensuremath{S_T}\xspace}

% Statistical
\def\E[#1]{\Tilde{\mathbb{E}}\!\left[#1\right]}
\def\Et[#1]{\Tilde{\mathbb{E}}_t\!\left[#1\right]}
\def\Var[#1]{\Tilde{\mathbb{V}}\mathtt{ar}\!\left[#1\right]}
\def\Prob(#1){\Tilde{\mathbb{P}}\!\left(#1\right)}

% Derivatives
\def\S{\ensuremath{S_t}\xspace}
\def\dP{\ensuremath{d\Pi_t}\xspace}
\def\dS{\ensuremath{dS_t}\xspace}
\def\dt{\ensuremath{dt}\xspace}
\def\dW{\ensuremath{dW_t}\xspace}
\def\dq{\ensuremath{dq_t}\xspace}
\def\Vt{\frac{\partial V}{\partial t}}
\def\Vs{\frac{\partial V}{\partial S}}
\def\Vss{\frac{\partial^2 V}{\partial S^2}}

% Differences
\def\DS{\ensuremath{\delta S_t}\xspace}
\def\Dt{\ensuremath{\delta t}\xspace}
\def\DW{\ensuremath{\delta W_t}\xspace}
\def\Dq{\ensuremath{\delta q_t}\xspace}

% Finite difference
\def\Vjn{\ensuremath{V^{n}_j}\xspace}
\def\Vjnm{\ensuremath{V^{n - 1}_j}\xspace}
\def\Vjnp{\ensuremath{V^{n + 1}_j}\xspace}
\def\Vjmn{\ensuremath{V^{n}_{j - 1}}\xspace}
\def\Vjpn{\ensuremath{V^{n}_{j + 1}}\xspace}
\def\Vjmnm{\ensuremath{V^{n - 1}_{j - 1}}\xspace}
\def\Vjpnm{\ensuremath{V^{n - 1}_{j + 1}}\xspace}
\def\Vjmnp{\ensuremath{V^{n + 1}_{j - 1}}\xspace}
\def\Vjpnp{\ensuremath{V^{n + 1}_{j + 1}}\xspace}

\def\Von{\ensuremath{V^{n}_{0}\xspace}}
\def\Vomn{\ensuremath{V^{n}_{-1}\xspace}}
\def\Vopn{\ensuremath{V^{n}_{1}\xspace}}
\def\VJn{\ensuremath{V^{n}_{J}\xspace}}
\def\VJmn{\ensuremath{V^{n}_{J - 1}\xspace}}
\def\VJpn{\ensuremath{V^{n}_{J + 1}\xspace}}
\def\Vonm{\ensuremath{V^{n - 1}_{0}\xspace}}
\def\Vomnm{\ensuremath{V^{n - 1}_{-1}\xspace}}
\def\Vopnm{\ensuremath{V^{n - 1}_{1}\xspace}}
\def\VJnm{\ensuremath{V^{n - 1}_{J}\xspace}}
\def\VJmnm{\ensuremath{V^{n - 1}_{J - 1}\xspace}}
\def\VJpnm{\ensuremath{V^{n - 1}_{J + 1}\xspace}}

\def\Sz{\ensuremath{S_0}\xspace}
\def\Sj{\ensuremath{S_j}\xspace}
\def\SJ{\ensuremath{S_J}\xspace}
\def\Xj{\ensuremath{X_j}\xspace}

% Binomial model
\def\u{\ensuremath{u}\xspace}
\def\d{\ensuremath{d}\xspace}
\def\o{\ensuremath{o}\xspace}

\def\pu{\ensuremath{p_\u}\xspace}
\def\pd{\ensuremath{p_\d}\xspace}
\def\po{\ensuremath{p_\o}\xspace}

% Binomial model valuation
\def\V{\ensuremath{V_t}\xspace}
\def\Vu{\ensuremath{V^{u}_t}\xspace}
\def\Vd{\ensuremath{V^{d}_t}\xspace}
\def\X{\ensuremath{X_t}\xspace}
\def\P{\ensuremath{\Pi_t}\xspace}
\def\D{\ensuremath{\Delta_t}\xspace}

% Sundry
\def\th{\textsuperscript{th}\xspace}
\def\half{\tfrac{1}{2}}

% PREAMBLE -------------------------------------------------------

\title{Valuation of Convertible Bonds with Credit Risk}

\author{David Naylor\\[2cm]
Programme in Advanced Mathematics of Finance,\\
University of the Witwatersrand,\\
Johannesburg.\\[2cm]
\includegraphics[width=4cm]{../common/WitsColourLogo}\\[2cm]
}

% MAIN DOCUMENT --------------------------------------------------

\begin{document}

\maketitle \setlinespacing{1.20}

% DECLARATION ----------------------------------------------------

\def\abstractname{\Huge Declaration}
\begin{abstract}
I declare that this project is my own, unaided work. It is being submitted as partial fulfilment of the Degree of Bachelor of Science with Honours in the University of the Witwatersrand, Johannesburg. It has not been submitted before for any degree or examination in any other University.\\[3cm]
\noindent\rule{5cm}{0.5pt}\\[1cm]
\noindent \today
\end{abstract}

% ABSTRACT -------------------------------------------------------

\def\abstractname{\Huge Abstract}
\begin{abstract}
A convertible bond is a complex derivative that cannot be priced as a simple combination of bond and stock components.  Convertible bonds can be broken down as a bond with two embedded options (a put option for the investor and a call option for the issuer) and an option to convert the bond into stock.  Due to the multiple continuous options, the pricing of the convertible bond is path dependent.

This research project explores and implements a binary tree and finite difference scheme to price the convertible bond, taking into account credit risk.
\end{abstract}

% ACKNOWLEDGEMENTS -----------------------------------------------

\def\abstractname{\Huge Acknowledgements}
\begin{abstract}
Place acknowledgements here.
\end{abstract}

% TABLE OF CONTENTS ----------------------------------------------

\setlinespacing{1}
\pagenumbering{roman}
\tableofcontents
\listoffigures
\listoftables
\clearpage
\setlinespacing{1.20}
\pagenumbering{arabic}
\setcounter{page}{1}

% CONTENT --------------------------------------------------------

\chapter{Introduction}
What this paper shows and does.

\section{Convertible Bonds with Credit Risk}
A convertible bond is an annuity, which pays coupons \C at \ti and pays \R at maturity \T, with the following embedded options:
\begin{itemize}
 \item \emph{A put option for the bond holder:} the bond holder may redeem the bond early for \Kp, provided $\t \in \Tp$.  This option is not applicable at termination, $T \not\in \Tp$.
 \item \emph{A call option for the bond issuer:} the bond issuer may force early redemption of the bond for \Kc, provided $\t \in \Tc$.  Normally $\Kc > \Kp$.  This option is not applicable at termination, $T \not\in \Tc$.
 \item \emph{A conversion option:} the bond holder may convert the bond into \Kv shares, for a value of $\Kv\S$, provided $\t \in \Tv$.  To optimise profits the bond holder would rather convert than exercise if $\Kp < \Kv\S$.  This option supersedes the call option (i.e. if the bond issuer forces early redemption the bond holder may still convert the bond into shared).  This option is applicable at termination, $T \in \Tv$.
\end{itemize}

In the event of default the bond holder may either recover the remains of the annuity or convert into the stock, which ever is worth more.  Default is considered terminal.

Suppose the recovery of the bond is $\gamma$, and the drop in share price is $\eta$, then the value of the convertible bond in default is\footnote{This is assuming the bond recovery is based on the redemption value.  Another possibility is to base the recovery on the bond value at time \t}:
\begin{equation}
 \X = \max(\gamma\R, (1 - \eta)\Kv\S)
\end{equation}


Table \ref{tab:choices} illustrated the various choices made by the bond holder and the bond issuer, and under what circumstances those choices are made.  Figure \ref{fig:choices} illustrates the actions taken on the bond over the lifetime of a convertible bond.  The impact of coupons is left as an implementation detail.
\begin{table}[ht]
 \centering
 \begin{tabular}{|l|l|l|}\hline
  \theader{Action}    & \theader{Payoff} & \theader{Condition} \h
  Put                 & \Kp              & $(\V \le \Kp)\wedge(\t \in \Tp)\wedge[(\Kv\S < \V)\lor(\t \not\in \Tv)]$ \h
  Call                & \Kc              & $(\V \ge \Kc)\wedge(\t \in \Tc)\wedge[(\Kv\S < \Kc)\lor(\t \not\in\Tv)]$ \h
  Conversion          & $\Kv\S$          & $(\Kv\S \ge \V)\wedge(\t \in \Tv)$ \h
  Forced conversion   & $\Kv\S$          & $(\V > \Kv\S \ge \Kc)\wedge(\t \in \Tv)\wedge(\t \in \Tc)$ \h
  Redemption          & \R               & $(\t = \T)\wedge[(\Kv\S \le \R)\lor(\t \not\in \Tv)]$ \h
  Hold                &                  & \emph{otherwise} \h
 \end{tabular}
 \caption[Payoff for the convertible bond]{Payoff for the convertible bond.  \V is assumed to be the intrinsic value in this context only}
 \label{tab:choices}
\end{table}

\section{Literature Review}
Describe the current state of literature w/ Convertible Bonds with Credit Risk,
possibly split this and include it at the beginning of each relevant section?


\chapter{Finite Difference Model}
Describe the finite difference model based on the paper by \citet{AFV03}.

\section{Definition}
Consider a stock with the following stochastic model for stock price movements:
\begin{equation}
 \dS = \mu\S\dt + \sigma\S\dW - \eta\S\dq
\end{equation}
If we impose that the risk neutral expectation of the stock price evolve at the risk free rate $\E[\dS] = r\S\dt$ then $\mu = (r + \lambda\eta)$ and the differential equation becomes:
\begin{equation}
 \dS = (r + \lambda\eta)\S\dt + \sigma\S\dW - \eta\S\dq
\end{equation}
where:

\begin{tabular}{ll}
 $\mu$          & is the drift rate of the stock price \\
 $r$            & is the risk free rate \\
 $\sigma$       & is the log-volatility of the stock price \\
 $\lambda$      & is the hazard rate \\
 $\eta$         & is the percentage drop in stock price on a default event \\
 \dW            & is a Wiener process \\
 \dq            & is a Poisson jump process where the first jump is the default event \\
\end{tabular}

\section{Derivation}
Consider a portfolio, \P, that has a long position in the derivative, \V, and a short position of \D in the stock, \S.  The residual $\P = \V - \D\S$ is invested at the risk neutral rate.  This yields a differential equation for \P:
\begin{align}
 \dP &= r\P\dt \n
     &= r(\V - \D\S)\dt \label{eq:rPdt}
\end{align}

In the event of default the portfolio holdings $\P^x$ has a long position in the derivative with residual value \X and a short position of \D in the stock with residual value of $(1 - \eta)\S$.  Thus the difference of the portfolio holdings when going into default is:
\begin{align}
 \dP^x &= \P^x - \P \n
        &= \X - (\V - \eta\D\S) \label{eq:dPx}
\end{align}

At any given instant the portfolio can either default or evolve in the normal stochastic manner.  The probability of default in any given instant is $\lambda\dt$ and the probability of non-default is $(1 - \lambda)\dt$.  Taking the expectation of the differential of \P and applying Ito's lemma to the stochastic component:
\begin{align}
 \Et[\dP] &= (1 - \lambda\dt)[\left(\Vt + \mu\S\Vs + \half\sigma^2\S^2\Vss - \mu\S\D\right)\dt + \n
          &\qquad \left(\sigma\S\Vs - \sigma\S\D\right)\dW] + \lambda\dt(\X - (\V - \eta\D\S))
\end{align}
By choosing \D to eliminate the \dW term, $\D = \Vs$, the differential simplifies to:
\begin{equation}
 \Et[\dP] = \left(\Vt + \half\sigma^2\S^2\Vss\right)\dt + \lambda\dt(\X - (\V - \eta\D\S)) \label{eq:EdP}
\end{equation}

Equating the differential \eqref{eq:rPdt} and the expected differential \eqref{eq:EdP} for \P the partial differential equation for a derivative with credit risk is derived:
\begin{align}
 r(\V - \D\S)\dt &= \left(\Vt + \half\sigma^2\S^2\Vss\right)\dt + \lambda\dt(\X - (\V - \eta\D\S)) \n
 (r + \lambda)\V &= \Vt + (r + \lambda\eta)\S\Vs + \half\sigma^2\S^2\Vss + \lambda\X
\end{align}

\section{Finite Difference}
The derived PDE can be solved numerically by constructing a lattice of stock prices and time.  \Vjn will denote the lattice value at the j\th stock node and n\th time node where the step between stock nodes is \DS and the step between time nodes is \Dt.  \Sj will denote the stock value at the j\th stock node and \Xj will denote the defaulted value at the j\th stock node.  The stock prices go from a minimum of \Sz to a maximum of \SJ.

All finite difference equations derived here can be expressed as functions of $\alpha$, $\beta$ and $\kappa$ where:
\begin{align*}
 \alpha &= \half\sigma^2\Sj^2\frac{\Dt}{\DS^2} - (r + \lambda\eta)\Sj\frac{\Dt}{2\DS} \\
 \beta  &= - (r + \lambda) - \sigma^2\Sj^2\frac{\Dt}{\DS^2} \\
 \kappa &= \half\sigma^2\Sj^2\frac{\Dt}{\DS^2} + (r + \lambda\eta)\Sj\frac{\Dt}{2\DS} \\
\end{align*}
and it is assumed that for boundary nodes:
\begin{align*}
 \frac{\Von - \Vomn}{\DS} &= \frac{\Vopn - \Von}{\DS} \\
                    \Vomn &= 2\Von - \Vopn \\
 \frac{\VJn - \VJmn}{\DS} &= \frac{\VJpn - \VJn}{\DS} \\
                    \VJpn &= 2\VJn - \VJmn \\
\end{align*}

\subsection{Explicit Scheme}
Using the backwards difference equation for the temporal derivative the finite difference equation is:
\begin{displaymath}
 (r + \lambda)\Vjn = \frac{\Vjn - \Vjnm}{\Dt} + (r + \lambda\eta)\Sj\frac{\Vjpn - \Vjmn}{2\DS} + \half\sigma^2\Sj^2\frac{\Vjmn - 2\Vjn + \Vjpn}{\DS^2} + \lambda\Xj
\end{displaymath}
\begin{align}
 \Vjnm &= \alpha\Vjmn + (1 + \beta)\Vjn + \kappa\Vjpn + \lambda\Dt\Xj \\
 \Vonm &= (1 + \beta + 2\alpha)\Von + (\kappa - \alpha)\Vopn + \lambda\Dt\Xj \\
 \VJnm &= (\alpha - \kappa)\Vjmn + (1 + \beta - 2\kappa)\VJn + \lambda\Dt\Xj
\end{align}

\subsection{Implicit Scheme}
Using the backwards difference equation for the temporal derivative and evaluating the spacial differentials at the previous time step the finite difference equation is:
\small\begin{displaymath}
 (r + \lambda)\Vjnm = \frac{\Vjn - \Vjnm}{\Dt} + (r + \lambda\eta)\Sj\frac{\Vjpnm - \Vjmnm}{2\DS} + \half\sigma^2\Sj^2\frac{\Vjmnm - 2\Vjnm + \Vjpnm}{\DS^2} + \lambda\Xj
\end{displaymath}\normalsize
\begin{align}
 -\alpha\Vjmnm + (1 - \beta)\Vjnm - \kappa\Vjpnm &= \Vjn + \lambda\Dt\X \\
 (1 - \beta - 2\alpha)\Vonm - (\kappa - \alpha)\Vopnm &= \Von + \lambda\Dt\X \\
 -(\alpha - \kappa)\VJmnm + (1 - \beta - 2\kappa)\VJnm &= \VJn + \lambda\Dt\X
\end{align}

\subsection{Crank-Nicolson Scheme}
Using the backwards difference equation for the temporal derivative and taking the average of the spacial differentials at the current and previous time step the finite difference equation is:
\small\begin{align*}
 (r + \lambda)\half(\Vjn + \Vjnm) &= \frac{\Vjn - \Vjnm}{\Dt} + (r + \lambda\eta)\Sj\frac{1}{2}\left(\frac{\Vjpn - \Vjmn}{2\DS} + \frac{\Vjpnm - \Vjmnm}{2\DS}\right) + \\
  &\quad \half\sigma^2\Sj^2\frac{1}{2}\left(\frac{\Vjmn - 2\Vjn + \Vjpn}{\DS^2} + \frac{\Vjmnm - 2\Vjnm + \Vjpnm}{\DS^2}\right) + \lambda\Xj
\end{align*}
\begin{align}
 -\alpha\Vjmnm + (2 - \beta)\Vjnm - \kappa\Vjpnm &= \alpha\Vjmn + (2 + \beta)\Vjn + \kappa\Vjpn + 2\lambda\Dt\X \\
 (2 - \beta - 2\alpha)\Vonm - (\kappa - \alpha)\Vopnm &= (2 + \beta + 2\alpha)\Von + (\kappa + \alpha)\Vopn + 2\lambda\Dt\X \\
 -(\alpha - \kappa)\VJmnm + (2 - \beta - 2\kappa)\VJnm &= (\alpha - \kappa)\VJmn + (2 + \beta + 2\kappa)\VJn + 2\lambda\Dt\X
\end{align}\normalsize


\chapter{Binomial Model}
The Binomial Model with Credit Risk was first derived by \citet{MK12}, who showed that this model converges, in continuous time, to the \citet{AFV03} model.  \Citet{MK12} also showed the valuation method of this model is the same as in the classical binomial model.

TODO: add further explanation and references.

\section{Definition}
Consider a binomial model that has time step \Dt, up and down steps, \u and \d with probability \pu and \pd\footnote{$\pd = 1 - \pu - \po = e^{-\lambda\Dt} - \pu$} respectively, and where the probability of default is \po\footnote{The time till the first jump follows an exponential distribution with intensity $\lambda$ and has probability $\Prob(q_{t + \dt} = 1 | q_t = 0) = \po = 1 - e^{-\lambda\Dt}$}.  The mean and variance of this model is: (TODO: insert picture illustration)
\begin{align}
 \E[\frac{S_{t + \Dt}}{\S}]     &= \u\pu + \d\pd + (1 - \eta)\po \n
                                &= \u\pu + \d(e^{-\lambda\Dt} - \pu) + (1 - \eta)(1 - e^{-\lambda\Dt}) \label{eq:BM_E} \\
 \Var[\frac{S_{t + \Dt}}{\S}]   &= \u^2\pu + \d^2\pd + (1 - \eta)^2\po - \E[\frac{\DS}{\S}]^2 \n
                                &= \u^2\pu + \d^2(e^{-\lambda\Dt} - \pu) + (1 - \eta)^2(1 - e^{-\lambda\Dt}) - \E[\frac{S_{t+\Dt}}{\S}]^2 \label{eq:BM_Var}
\end{align}

The mean and variance of the stock's stochastic differential equation is:
\begin{align}
 \E[\frac{\dS}{\S}]     &= r\dt \\
 \E[\frac{S_{t + \dt}}{\S}] &= \E[\frac{\S}{\S} + \frac{\dS}{\S}] \n
                        &= 1 + \E[\frac{\dS}{\S}] \label{eq:SM_E} \\
 \Var[\frac{\dS}{\S}]   &= (\sigma^2 + \lambda\eta^2)\dt \\
 \Var[\frac{S_{t + \dt}}{\S}] &= \Var[\frac{\S}{\S} + \frac{\dS}{\S}] \n
                        &= \Var[\frac{\dS}{\S}] \label{eq:SM_Var}
\end{align}


\section{Derivation}
If one equates the first moment of the stochastic model \eqref{eq:SM_E}\footnote{$\E[\frac{S_{t + \Dt}}{\S}] = e^{r\Dt}$}, in \Dt time, with that of the binomial model \eqref{eq:BM_E} then:
\begin{align}
 e^{r\Dt}       &= \u\pu + \d(e^{-\lambda\Dt} - \pu) + (1 - \eta)(1 - e^{-\lambda\Dt}) \n
 \pu(\u - \d)   &= e^{r\Dt} - \d e^{-\lambda\Dt} - (1 - \eta)(1 - e^{-\lambda\Dt}) \label{eq:p(u-d)}\\
 \pu            &= \frac{e^{r\Dt} - \d e^{-\lambda\Dt} - (1 - \eta)(1 - e^{-\lambda\Dt})}{\u - \d} \\
 \therefore\quad\pd &= -\frac{e^{r\Dt} - \u e^{-\lambda\Dt} - (1 - \eta)(1 - e^{-\lambda\Dt})}{\u - \d}
\end{align}
and if one equate the second moment about the mean of the stochastic model \eqref{eq:SM_Var}, in \Dt time, with that of the binomial model \eqref{eq:BM_Var} then\footnote{Substituting equation \eqref{eq:p(u-d)} into \eqref{eq:Var=1} one gets \eqref{eq:Var=2}}:
\begin{align}
 (\sigma^2 + \lambda\eta^2)\Dt &= \u^2\pu + \d^2(e^{-\lambda\Dt} - \pu) + (1 - \eta)^2(1 - e^{-\lambda\Dt}) - \E[\frac{S_{t + \Dt}}{\S}]^2 \n
                        &= (\u^2 - \d^2)\pu + \d^2 e^{-\lambda\Dt} +  (1 - \eta)^2(1 - e^{-\lambda\Dt}) - e^{-2r\Dt} \label{eq:Var=1} \\
                        &= (\u + \d)(e^{r\Dt} - \d e^{-\lambda\Dt} - (1 - \eta)(1 - e^{-\lambda\Dt})) \label{eq:Var=2} \\
                        &\qquad + \d^2 e^{-\lambda\Dt} + (1 - \eta)^2(1 - e^{-\lambda\Dt}) - e^{-2r\Dt} \n
                        &= (\u + \d)(e^{r\Dt} - (1 - \eta)(1 - e^{-\lambda\Dt})) - \u\d e^{-\lambda\Dt} \label{eq:Var=} \\
                        &\qquad + (1 - \eta)^2(1 - e^{-\lambda\Dt}) - e^{-2r\Dt} \nonumber
\end{align}
If one assumes $\Dt^2 = 0$, $\u\d = 1$ and $\u = e^{\sqrt{A\Dt}}$ and the Taylor series expansion is taken for all exponential terms, then:
\begin{align}
 \u                     &= 1 + \sqrt{A\Dt} + \frac{A\Dt}{2!} + \frac{(A\Dt)^{\frac{3}{2}}}{3!} \n
 \d                     &= 1 - \sqrt{A\Dt} + \frac{A\Dt}{2!} - \frac{(A\Dt)^{\frac{3}{2}}}{3!} \n
 \u + \d                &= 2 + A\Dt \label{eq:u+d}
\end{align}
and substituting \eqref{eq:u+d} into \eqref{eq:Var=} with the appropriate expansions then:
\begin{align}
 (\sigma^2 + \lambda\eta^2)\Dt &= (2 + A\Dt)(1 + r\Dt - \lambda\Dt(1 - \eta)) - (1 - \lambda\Dt) \n
                        &\qquad + \lambda\Dt(1 - \eta)^2 - (1 - 2r\Dt) \n
                        &= A\Dt + \lambda\Dt - \lambda\Dt(1 - \eta)(1 + \eta) \n
                        &= A\Dt + \lambda\eta^2\Dt \n
 A\Dt                   &= \sigma^2\Dt
\end{align}

\section{Limits}
The time step \Dt is assumed to be strictly positive ($\Dt > 0$), as time is monotonically increasing.

Although $\sigma$ could be positive or negative, the formul\ae\ use $\sigma$ where, strictly, $|\sigma|$ should be used.  If $\sigma = 0$ then the model is no longer useful.  The restriction $\sigma > 0$ may be introduced for convenience and without loss of generality.

An implicit assumption this model makes is that \pu, \pd and \po are a valid probability measure.  This imposes the following conditions:
\begin{align}
 \min(\pu, \pd, \po) &\ge 0 \\
 \pu + \pd + \po &= 1 \label{eq:bin_prob_limit}
\end{align}

Consider \po, the probability of default.  Its value is equal to the cumulative density function of an exponential distribution with intensity $\lambda$.  As such \po is already confined to the interval $[0, 1]$ with the restriction that $\lambda > 0$.  If $\lambda = 0$, no default is possible, then \po will have a value of 0 and is a valid probability thus the restriction on $\lambda$ can be relaxed to $\lambda \ge 0$.

Consider \pd, the probability of a down movement.  Its value is defined in terms of \pu and \po.  If \pu and \po are valid probabilities, within bounds, then so will \pd.

Consider \pu, the probability of an up movement.  Taking into account the definition of \pd, this requires that \pu satisfies:
\begin{align}
 0 &\le \pu \le e^{-\lambda \Dt} \\
 0 &\le \frac{e^{r\Dt} - \d e^{-\lambda\Dt} - (1 - \eta)(1 - e^{-\lambda\Dt})}{\u - \d} \le e^{-\lambda \Dt} \n
 0 &\le e^{r\Dt} - \d e^{-\lambda\Dt} - (1 - \eta)(1 - e^{-\lambda\Dt}) \le e^{-\lambda \Dt}(\u - \d) \n
 e^{-\lambda\Dt}(\d - (1 - \eta)) &\le e^{r\Dt} - (1 - \eta) \le e^{-\lambda\Dt}(\u - (1 - \eta)) \n
 \ln\left(\frac{d - (1 - \eta)}{e^{r\Dt} - (1 - \eta)}\right) &\le \lambda\Dt \le \ln\left(\frac{u - (1 - \eta)}{e^{r\Dt} - (1 - \eta)}\right) \\
 \Dt &\le \frac{1}{\lambda}\ln\left(\frac{u - (1 - \eta)}{e^{r\Dt} - (1 - \eta)}\right)
\end{align}
Using the limit on both \Dt and $\lambda$ the inequalities around the $\lambda\Dt$ are also limited thus:
\begin{align}
 0 &\le \ln\left(\frac{u - (1 - \eta)}{e^{r\Dt} - (1 - \eta)}\right) \n
 e^{r\Dt} - (1 - \eta) &\le u - (1 - \eta) \n
 r\Dt &\le \sigma \sqrt{\Dt} \n
 \Dt &\le \frac{\sigma^2}{r^2}
\end{align}
The inequality of $\ln\left(\frac{d - (1 - \eta)}{e^{r\Dt} - (1 - \eta)}\right) \le 0$ results in the same inequality as above.

Based on the probability limits \eqref{eq:bin_prob_limit} no restriction is placed on $r$, the risk free rate, or $\eta$, the percentage drop in stock price.

\section{Valuation}
Consider a portfolio, \P, that has a long position in the derivative, \V, and a short position of \D in the stock, \S.  The residual $\P = \V - \D\S$ is invested at the risk neutral rate.  At time $t + \Dt$ one should have:
\begin{equation*}
 \Pi_{t + \Dt} =
 \begin{cases}
  \Vu - \D\S u          & \text{with probability } \pu \\
  \Vd - \D\S d          & \text{with probability } \pd\\
  \X - (1 - \eta)\S     & \text{with probability } \po\\
 \end{cases}
\end{equation*}
where

\begin{tabular}{ll}
 $\Vu$          & is the value of the portfolio on an up-step at time $t + \Dt$ \\
 $\Vd$          & is the value of the portfolio on a down-step at time $t + \Dt$ \\
 $\X$           & is the value of default at time $t$ \\
\end{tabular}

If one wishes to hedge against up and down movements of the stock then:
\begin{align}
    \Vu - \D\S u &= \Vd - \D\S d \n
     \D\S(d - u) &= \Vd - \Vu \n
              \D &= \frac{\Vu - \Vd}{\S(u - d)}
\end{align}

The required value of \P at time $t + \Dt$ is:
\begin{align}
 \Pi_{t + \Dt}  &= \P e^{r\Dt} \n
                &= \left(\V - \frac{\Vu - \Vd}{u - d}\right) e^{r\Dt} \label{eq:P}
\end{align}
as \P is invested at the risk free rate, and taking the expected value of $\Pi_{t + \Dt}$, which must equal \eqref{eq:P}, one gets:
\begin{align}
 \left(\V - \frac{\Vu - \Vd}{u - d}\right) e^{r\Dt} &= \Et[\Pi_{t + \Dt}] \n
        &= \left(\Vu - \frac{\Vu - \Vd}{u - d}u\right) e^{-\lambda\Dt} \n
        &\qquad + \left(\X - \frac{\Vu - \Vd}{u - d}(1 - \eta)\right)(1 - e^{-\lambda\Dt}) \n
        &= \Vu\left(e^{-\lambda\Dt} - \frac{ue^{-\lambda\Dt} + (1 - \eta)(1 - e^{-\lambda\Dt})}{u - d}\right) \n
        &\qquad + \Vd\left(\frac{ue^{-\lambda\Dt} + (1 - \eta)(1 - e^{-\lambda\Dt})}{u - d}\right) + \X(1 - e^{-\lambda\Dt}) \n
 \V e^{r\Dt} &= \Vu\frac{e^{r\Dt} - de^{-\lambda\Dt} - (1 - \eta)(1 - e^{-\lambda\Dt})}{u - d} \n
        &\qquad + \Vd\frac{ue^{-\lambda\Dt} + (1 - \eta)(1 - e^{-\lambda\Dt}) - e^{r\Dt}}{u - d} + \X(1 - e^{-\lambda\Dt}) \n
 \V     &= e^{-r\Dt}(\Vu\pu + \Vd\pd + \X\po)
\end{align}
thus the pricing method of this binomial model is the same as the pricing method of the classical binomial model:
\begin{align}
 V_t    &= e^{-r\Dt}(\Vu\pu + \Vd\pd + \X\po) \n
        &= e^{-r\Dt}\Et[V_{t + \Dt}]
\end{align}

\section{Valuation with Coupon Cash-flow}
Consider a portfolio, as above, with the add of coupon cash flows.  At time $t + \Dt$ one should have:
\begin{equation*}
 \Pi_{t + \Dt} =
 \begin{cases}
  \Vu - \D\S u + c_i e^{t + \Dt - t^{c}_i}      & \text{with probability } \pu \\
  \Vd - \D\S d + c_i e^{t + \Dt - t^{c}_i}      & \text{with probability } \pd\\
  \X - (1 - \eta)\S + c_i (1 - q_{t^{c}_i})e^{t + \Dt - t^{c}_i} & \text{with probability } \po\\
 \end{cases}
\end{equation*}
where

\begin{savenotes}
\begin{tabular}{ll}
 $c_i$          & is the i\textsuperscript{th} coupon value \\
 $t^{c}_i$      & is the time of the i\textsuperscript{th} coupon, with $t^{c}_i \in (t, t + \Dt)$ \\
 $q_{t^{c}_i}$  & is an indicator variable that default happens after coupon payment\footnote{$\Prob(q_{t^{c}_i} = 0 | q_s = 1, s \in (t, t + \Dt]) = \frac{e^{-\lambda(t^{c}_i - t)} - e^{-\lambda\Dt}}{1 - e^{-\lambda\Dt}}$, the probability that the coupon arrives before default occurs, given that default occurs within the interval}
\end{tabular}
\end{savenotes}

Using the above method it is trivial to show that:
\begin{align}
 V_t    &= e^{-r\Dt}(\Vu\pu + \Vd\pd + \X\po) + c_i e^{-(r + \lambda)(t^{c}_i - t)} \n
        &= e^{-r\Dt}\Et[V_{t + \Dt}] + c_i e^{-(r + \lambda)(t^{c}_i - t)}
\end{align}
if, however, $t^{c}_i = t$, thus $c_i$ arrives with certainty at $t$, it is trivially shown that:
\begin{align}
 V_t    &= e^{-r\Dt}(\Vu\pu + \Vd\pd + \X\po) + c_i \n
        &= e^{-r\Dt}\Et[V_{t + \Dt}] + c_i
\end{align}

\section{Parameters and Formul\ae\ of Model}
Based on the above Table \ref{tab:bin_parameter} lists the parameters required for, Table \ref{tab:bin_limit} lists the limits of, and Table \ref{tab:bin_formulae} lists the formul\ae\ to price, this binomial tree.

\begin{table}[ht]
\centering
\caption{Parameters of the Binomial Model with Credit Risk}
\begin{tabular}{|r|l|}\hline
 \theader{Parameter} & \theader{Description} \h
 $r$                 & Risk free rate \h
 $\sigma$            & Log-volatility of the stock price \h
 $\lambda$           & Hazard rate of default \h
 $\eta$              & Percentage drop of stock price in a default event \h
 \Dt                 & Time-step \h
 \Vu                 & Value of portfolio for an up-step at $t + \Dt$ \h
 \Vd                 & Value of portfolio for a down-step at $t + \Dt$ \h
 \X                  & Value of defaulted portfolio at $t$ \h
 $c_i$               & Value of the i\textsuperscript{th} coupon payment \h
 $t^{c}_i$           & Time of the i\textsuperscript{th} coupon payment \h
\end{tabular}
\label{tab:bin_parameter}
\end{table}

\begin{savenotes}
\begin{table}[ht]
\centering
\caption{Limits of the Binomial Model with Credit Risk}
\begin{tabular}{|c|l|}\hline
 \theader{Limit}                & \theader{Description} \h
 $0 < \sigma$                   & Volatility must be positive \h
 $0 \le \lambda$                & Hazard rate must be non-negative \h
 $0 < \Dt$                      & Time step must be positive \h
 $\Dt \le \frac{\sigma^2}{r^2}$ & Time step must be small enough to handle volatility\footnote{If $r = 0$ then this inequality is not applicable.} \h
 $\Dt \le \frac{1}{\lambda}\ln\left(\frac{u - (1 - \eta)}{e^{r\Dt} - (1 - \eta)}\right)$ & Time step must be small enough to handle hazard rate\footnote{If $\lambda = 0$ then this inequality is not applicable.} \h
\end{tabular}
\label{tab:bin_limit}
\end{table}
\end{savenotes}

\begin{table}[ht]
\centering
\caption{Formal\ae\ for the Binomial Model with Credit Risk}
\begin{tabular}{|r@{ = }l|l|l|}\hline
 \multicolumn{2}{|c|}{\textbf{Formul\ae}} & \theader{Description} \h
 \u     & $e^{\sigma\sqrt{\Dt}}$ &
    Multiplier for an up-step \h
 \d     & $e^{-\sigma\sqrt{\Dt}}$ &
    Multiplier for a down-step \h
 \pu    & $\frac{e^{r\Dt} - \d e^{-\lambda\Dt} - (1 - \eta)(1 - e^{-\lambda\Dt})}{\u - \d}$ &
    Probability of an up-step \h
 \pd    & $e^{-\lambda\Dt} - \pu$ &
    Probability of a down-step \h
 \po    & $1 - e^{-\lambda\Dt}$ &
    Probability of default \h
 \V     & $e^{-r\Dt}(\Vu\pu + \Vd\pd + \X\po) + c_i$ &
    Value of portfolio at $t$ for $t^{c}_i = t$ \h
\end{tabular}
\label{tab:bin_formulae}
\end{table}

\section{Example and Hedging Strategy}
Provide a numerical example (with diagrams) and provide example of the hedging strategy.


\chapter{Numerical Example}
In the following analysis of the numerical results Table \ref{tab:bond_parameters}, the bond parameters, and Table \ref{tab:stock_parameters}, the stock parameters, are used as a basis.  There are three different types of stock price decreases that are used: total default when the stock losses all value, typical default when the stock losses 40\% and partial default where the stock price doesn't lose any value.

If $\t^+$ is the time immediately after a coupon payment and $\t^-$ is the immediately before a coupon payment then the coupon payment is handled as follows:
\begin{equation}
 V_{t^{-}_i} = V_{t^{+}_i} + \C
\end{equation}
and it is assumed that embedded options can only be exercised after receiving the coupon payment (i.e. at $t^{+}_i$).

\begin{savenotes}
\begin{table}[ht]
 \centering
 \caption{Convertible Bond Parameters}
 \begin{tabular}{|c|l|c|} \hline
  \theader{Component}         & \theader{Parameter} & \theader{Value} \h
  \multirow{5}{*}{Annuity}    & Notional\footnote{$\R := 104$} & $100$ \\
                              & Coupon\footnote{$\C := 4$} & 8\% \\
                              & Coupon frequency\footnote{$\ti := \{0.5, 1, \ldots, 4.5\}$} & Semi-annually \\
                              & Maturity            & $\T := 5$ \\
                              & Recovery            & $\gamma := 0\%$ \h
  \multirow{2}{*}{Put}        & Strike              & $\Kp := 105$ \\
                              & Period(s)           & $\Tp := \{3\}$ \h
  \multirow{2}{*}{Call}       & Strike\footnote{The strike of 110 is the clean price and needs to be adjusted for accrued interest, on a simple interest basis} & $\Kc := 110 + \C\tfrac{t \pmod {0.5}}{0.5}$ \\
                              & Period(s)           & $\Tc := [2, 5)$ \h
  \multirow{2}{*}{Conversion} & Quantity of stocks  & $\Kv := 1$ \\
                              & Period(s)           & $\Tv := [0, 5]$ \h
 \end{tabular}
 \label{tab:bond_parameters}
\end{table}
\end{savenotes}

\begin{table}[ht]
 \centering
 \caption{Stock Parameters}
 \begin{tabular}{|l|l|} \hline
  \theader{Parameter} & \theader{Value} \h
  Risk free rate      & $r := 5\%$ \h
  Volatility          & $\sigma := 20\%$ \h
  Hazard rate         & $\lambda := 2\%$ \h
  Default (total)     & $\eta := 100\%$ \h
  Default (typical\footnote{\citet{BP95} found that stock prices typically drop 30\% on announcement of default} & $\eta := 30\%$ \h
  Default (partial)   & $\eta := 0\%$ \h
 \end{tabular}
 \label{tab:stock_parameters}
\end{table}

\section{Payoff}
Figure \ref{fig:choices} illustrates the payoff of the convertible bond over it's lifetime, and the actions that led to the payoff (see Table \ref{tab:choices} for the list of actions, the associated payoff and the conditions required for the payoff).

The figure has clear jumps at each coupon payment, producing a saw effect.  The other influencing factors are shown below:
\begin{itemize}
 \item \emph{Put:} the ``Put'' action is taken at time $\t = 3$ at stock prices from $\S = 0$ till $\S \approxeq 75$.  This option causes the value of the convertible bond prior to time $\t = 3$ to be elevated due to the higher payoff than the intrinsic value.
 \item \emph{Call:} the ``Call'' action is taken from time $\t = 2$ till almost $\t = 5$ with a narrow plateau around stock prices around $\S = 110$.  The call option does reduce the intrinsic value as apposed to being just the base for the forced conversion.
 \item \emph{Conversion:} on termination the ``Conversion'' action is taken for $\S \ge 104$.  At no other time is there voluntary conversion as, at time $\t = 2$ the upper payoff is similar to that of a forward and for similar reasons the value of the convertible bond increases.  Due to the increasing value the intrinsic value is never below the conversion threshold.
 \item \emph{Forced conversion:} the ``Forced conversion'' action is taken from time $\t = 2$ till almost $\t = 5$ above stock price $\S \approxeq 110$.
 \item \emph{Redemption:} on termination the ``Redemption'' action is taken for $\S < 104$.
 \item \emph{Hold:} the convertible bond is held for all other areas.  Of particular note is at time $\t = 3$ there is a narrow ``window'' from stock price $\S \approxeq 75$ to $\S \approxeq 110$ where the bond holder will not redeem, or be forced to redeem, the bond.  It is apparent that the changes of holding the bond beyond time $\t = 3$ is quite small.  Due to this the convertible bond value is dominated by the put, call and conversion options with the redemption value, and coupons after time $\t = 3$ having minimal impact.
\end{itemize}


\begin{figure}[ht]
 \centering
 \includegraphics[width=14cm]{../common/fig_choices}
 \caption[Payoff]{Payoff of the convertible bond with total default and colours indicating the action taken for that payoff.  $\Dt = 2^{-3}$, $\DS = 2^{1}$ and $\S \in [0, 250]$.}
 \label{fig:choices}
\end{figure}



\chapter{Conclusion}
Summarise what this paper shows and does (i.e. Introduction + Conclusion = Executive Summary).

\appendix
\chapter{Software and Hardware}

\chapter{Source Code}
\section{model.py}

\section{payoff.py}

\section{convertible\_bond/\_\_init\_\_.py}

\section{convertible\_bond/payoff.py}

\section{fig\_choices.py}

% BIBLIOGRAPHY ---------------------------------------------------

\clearpage
\setlinespacing{1}
\addcontentsline{toc}{chapter}{Bibliography}
\bibliographystyle{../references/amsplnat}
\bibliography{../references/references.bib}
\end{document}

%
% Document ends here - everything beyond this point is ignored.
%


% GRAPHIC TEMPLATE FOR EPS OR PDF FILE ---------------------------

\begin{figure}[h!]
    \centering
    \includegraphics[width=8cm]{filename}
    \caption[Short caption for figure list]{Main caption.}\label{FigLabel}
\end{figure}

% GRAPHIC TEMPLATE FOR JPG FILE ----------------------------------

\begin{figure}[h!]
    \centering
    \includegraphics[\bb=0 0 XXX YYY, width=8cm]{filename.jpg}
    \caption[Short caption for figure list]{Main caption.}\label{FigLabel}
\end{figure}

% Replace XXX and YYY with pixel width and height of image.

